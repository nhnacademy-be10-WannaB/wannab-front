<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/user-layout :: layout (
      'μ£Όλ¬Έ νμ΄μ§€',
      ~{::body},
      ~{::head}
    )}">

<head>
  <title>μ£Όλ¬Έ νμ΄μ§€</title>
  <link rel="stylesheet" th:href="@{/css/user/main-order.css}" />
</head>

<body>
<div class="order-wrapper">
  <section class="order-section">
    <h2 class="order-title">π§Ύ Check & Order</h2>
    <p class="order-sub">κ²°μ  μ§„ν–‰</p>

    <form th:action="@{/user/main-order/submit}" method="post">
      <div class="order-container">

        <!-- μ™Όμ½ λ³Έλ¬Έ -->
        <div class="order-main">

          <!-- μƒν’ λ©λ΅ -->
          <div class="order-items">
            <table class="order-table">
              <thead>
              <tr>
                <th>μƒν’</th>
                <th>μλ‰</th>
                <th>νλ§¤κ°€</th>
                <th>ν¬μ¥μ§€</th>
              </tr>
              </thead>
              <tbody>
              <tr th:each="book, iterStat : ${orderBookInfos}">
                <td>
                  <div class="order-product">
                    <img th:src="@{/static_images/testbook.png}" />
                    <div class="order-product-info">
                      <strong th:text="${book.title}">μ±… μ λ©</strong>
                    </div>
                  </div>
                  <input type="hidden" th:name="'bookOrderSubmitDtos[' + ${iterStat.index} + '].bookId'" th:value="${book.bookId}" />
                  <input type="hidden" th:name="'bookOrderSubmitDtos[' + ${iterStat.index} + '].bookSalesPrice'" th:value="${book.salesPrice}" />
                  <input type="hidden" th:name="'bookOrderSubmitDtos[' + ${iterStat.index} + '].bookQuantity'" th:value="${book.quantity}" />
                </td>
                <td th:text="${book.quantity}">1</td>
                <td th:text="|${#numbers.formatInteger(book.salesPrice, 3, 'COMMA')}μ›|">0μ›</td>
                <td>
                <!-- ν¬μ¥μ§€ μ„ νƒ -->
                <select th:name="'bookOrderSubmitDtos[' + ${iterStat.index} + '].wrappingPaperId'"
                        th:id="'wpSelect' + ${iterStat.index}"
                        th:attr="data-index=${iterStat.index}">
                  <option value="" data-price="0">ν¬μ¥μ§€ μ„ νƒ μ•ν•¨</option>
                  <option th:each="wp : ${wrappingPaperList}"
                          th:value="${wp.wpId}"
                          th:attr="data-price=${wp.price}"
                          th:text="${wp.name + ' (+ ' + #numbers.formatInteger(wp.price, 3, 'COMMA') + 'μ›)'}">
                  </option>
                </select>


                <!-- μ„ νƒλ ν¬μ¥μ§€ κ°€κ²© -->
                <input type="hidden"
                       th:id="'wpPriceInput' + ${iterStat.index}"
                       th:name="'bookOrderSubmitDtos[' + ${iterStat.index} + '].wrappingPaperPrice'"
                       value="0" />
                </td>

              </tr>
              </tbody>
            </table>
          </div>

          <!-- νμ›μΌ κ²½μ° -->
          <div th:if="${userId >= 0}" class="order-discount">
            <h4>ν¬μΈνΈ μ‚¬μ©</h4>
            <input
                    type="number"
                    id="usedPointsInput"
                    name="usedPoints"
                    min="0"
                    placeholder="0"
                    th:attr="max=${userPoints}"
            />
            <p th:text="|λ³΄μ  ν¬μΈνΈ: ${userPoints}P|">λ³΄μ  ν¬μΈνΈ: 0P</p>
          </div>


          <div th:if="${userPoints >= 0}" class="order-shipping">
            <h4>λ°°μ†΅μ§€ μ„ νƒ</h4>
            <ul>
              <li th:each="addr : ${userAddressList}">
                <label>
                  <input type="radio" name="addressId" th:value="${addr.addressId}" />
                  <span th:text="|${addr.address} ${addr.detailAddress}|">μ£Όμ†</span>
                </label>
              </li>
            </ul>
          </div>

          <!-- λΉ„νμ›μΌ κ²½μ° -->
          <div th:if="${userId < 0}" class="guest-info-section">
            <fieldset class="guest-info-box">
              <legend>μ£Όλ¬Έμ μ •λ³΄ μ…λ ¥</legend>
              <div class="input-group">
                <input type="text" name="guestName" placeholder="μ΄λ¦„μ„ μ…λ ¥ν•΄μ£Όμ„Έμ”." maxlength="10" required />
              </div>
              <input type="email" name="guestEmail" placeholder="μ΄λ©”μΌ μ£Όμ†λ¥Ό μ…λ ¥ν•΄μ£Όμ„Έμ”." required />
              <input type="tel" name="guestPhoneNumber" placeholder="ν΄λ€ν° λ²νΈλ¥Ό β€-β€™μ—†μ΄ μ…λ ¥ν•΄μ£Όμ„Έμ”" required />
              <p class="guide-text">μ…λ ¥ν•μ‹  μ •λ³΄λ΅ μ£Όλ¬Έ κ΄€λ ¨ λ¬Έμ λ° λ©”μΌμ΄ λ°μ†΅λ©λ‹λ‹¤.</p>
              <div class="password-section">
                <strong>μ£Όλ¬Έμ΅°ν λΉ„λ°€λ²νΈ μ…λ ¥</strong>
                <input type="password" name="guestPassword" placeholder="λΉ„λ°€λ²νΈλ¥Ό μ…λ ¥ν•΄μ£Όμ„Έμ”." required />
              </div>
            </fieldset>

            <fieldset class="delivery-info-box">
              <legend>λ°°μ†΅μ§€ μ •λ³΄</legend>
              <input type="text" name="guestAddress" placeholder="μ£Όμ†" required />
              <input type="text" name="guestDetailAddress" placeholder="μƒμ„Έ μ£Όμ†" />
            </fieldset>
          </div>

          <!-- ν¬λ§ λ°°μ†΅ λ‚ μ§ -->
          <div class="delivery-date">
            <h4>ν¬λ§ λ°°μ†΅ λ‚ μ§</h4>
            <input type="date" name="deliveryRequestAt" />
          </div>
        </div>

        <!-- μ¤λ¥Έμ½ κ²°μ  μ”μ•½ -->
        <div class="order-summary">
          <p>μ£Όλ¬ΈκΈμ•΅: <span th:text="|${#numbers.formatInteger(totalBookPrice, 3, 'COMMA')}μ›|">0μ›</span></p>
          <p>μΏ ν°ν• μΈ: <span class="minus" id="couponDiscountDisplay">-0μ›</span></p>
          <p>ν¬μΈνΈ: <span class="minus" id="usedPointsDisplay">-0μ›</span></p>
          <p>ν¬μ¥μ§€: <span class="plus" id="wrappingPriceDisplay">+0μ›</span></p>
          <p>λ°°μ†΅λΉ„: <span class="plus" th:text="|+ ${#numbers.formatInteger(shippingFee, 3, 'COMMA')}μ›|">+0μ›</span></p>
          <p class="summary-total">
            κ²°μ μμ •κΈμ•΅:
            <strong id="finalAmountDisplay" th:text="|${#numbers.formatInteger(totalBookPrice + shippingFee, 3, 'COMMA')}μ›|">0μ›</strong>
          </p>
          <button class="order-btn" type="submit">κ²°μ  ν•κΈ°</button>
        </div>
      </div>
    </form>
  </section>
</div>

<script th:inline="javascript">
  let totalBookPrice = /*[[${totalBookPrice != null ? totalBookPrice : 0}]]*/ 0;
  let shippingFee = /*[[${shippingFee != null ? shippingFee : 0}]]*/ 0;
</script>

<script th:src="@{/js/main-order.js}"></script>
</body>

</html>
