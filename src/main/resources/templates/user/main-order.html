<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/user-layout :: layout (
      '주문 페이지',
      ~{::body},
      ~{::head}
    )}">

<head>
  <title>주문 페이지</title>
  <link rel="stylesheet" th:href="@{/css/user/main-order.css}" />
  <script th:src="@{/js/main-order.js}"></script>

</head>

<body>
  <div class="order-wrapper">
    <section class="order-section">
      <h2 class="order-title">🧾 Check & Order</h2>
      <p class="order-sub">결제 진행</p>

      <div class="order-container">
        <!-- 상품 목록 -->
        <div class="order-items">
          <table class="order-table">
            <thead>
              <tr>
                <th>상품</th>
                <th>수량</th>
                <th>가격</th>
                <th>포장지</th>
                <th>쿠폰</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="item, iterStat : ${orderBookInfos}">
                <td>
                  <div class="order-product">
                    <img th:src="@{/static_images/testbook.png}" alt="book image"/>
                    <div class="order-product-info">
                      <strong th:text="${item.title}">책 제목</strong>
                    </div>
                  </div>
                </td>
                <td th:text="${item.quantity}">1</td>
                <td th:text="|${#numbers.formatInteger(item.salesPrice * item.quantity, 3, 'COMMA')}원|">0원</td>
                <td>
                  <select name="wrappingPapers" th:name="'orderItems[' + ${iterStat.index} + '].wrappingPaperId'">
                    <option th:each="wp : ${wrappingPaperList}" th:value="${wp.wpId}" th:text="${wp.name + ' (+ ' + #numbers.formatInteger(wp.price, 3, 'COMMA') + '원)'}">
                      포장지 없음
                    </option>
                  </select>
                </td>
                <td>
                  <select>
                    <option>-</option> <!-- 쿠폰 기능은 추후 개발 시 적용 -->
                  </select>
                </td>

                <!-- Hidden 주문 상품 정보 전달 -->
                <input type="hidden" th:name="'orderItems[' + ${iterStat.index} + '].bookId'" th:value="${item.bookId}" />
                <input type="hidden" th:name="'orderItems[' + ${iterStat.index} + '].quantity'" th:value="${item.quantity}" />
              </tr>
            </tbody>
          </table>

          <!-- 회원일 경우만 표시 -->
          <div class="order-discount" th:if="${userPoints >= 0}">
            <div class="discount-header">
              <h4>포인트 사용</h4>
              <input type="number" name="usedPoints" value="0" min="0" th:attr="max=${userPoints}" />
              <span class="point-label" th:text="|사용가능: ${userPoints}P|">사용가능: 0P</span>
            </div>
          </div>

          <!-- 배송지 선택 (회원) -->
          <div class="order-shipping" th:if="${userId > 0}">
            <h4>배송지 선택</h4>
            <ul>
              <li th:each="addr : ${userAddressList}">
                <label>
                  <input type="radio" name="addressId" th:value="${addr.addressId}" th:checked="${addrStat.index == 0}" />
                  <span th:text="|${addr.address} ${addr.detailAddress}|">배송지</span>
                </label>
              </li>
            </ul>
          </div>

          <!-- 비회원 주문자 정보 -->
          <section class="guest-info-section" th:if="${userPoints < 0}">
            <fieldset class="guest-info-box">
              <legend>주문자 정보 입력</legend>
              <div class="input-group">
                <input type="text" name="guestName" placeholder="이름을 입력해주세요." maxlength="10" />
              </div>
              <input type="email" name="guestEmail" placeholder="이메일 주소를 입력해주세요." />
              <input type="tel" name="guestPhone" placeholder="휴대폰 번호 (‘-’ 제외)" />
              <div class="password-section">
                <strong>주문조회 비밀번호</strong>
                <input type="password" name="guestPassword" placeholder="비밀번호를 입력해주세요." />
              </div>
            </fieldset>
            <fieldset class="delivery-info-box">
              <legend>배송지 정보</legend>
              <input type="text" name="guestAddress" placeholder="주소 입력" />
              <input type="text" name="guestDetailAddress" placeholder="상세 주소 입력" />
            </fieldset>
          </section>

          <!-- 배송 날짜 -->
          <h4>희망 배송 날짜</h4>
          <input type="date" name="desiredDate" />
        </div>

        <!-- 결제 요약 -->
        <div class="order-summary">
          <p th:text="|주문금액: ${#numbers.formatInteger(totalBookPrice, 3, 'COMMA')}원|">주문금액: 0원</p>
          <p th:text="|배송비: +${#numbers.formatInteger(shippingFee, 3, 'COMMA')}원|">배송비: 0원</p>
          <p class="summary-total"
             th:text="|결제예정금액: ${#numbers.formatInteger(totalBookPrice + shippingFee, 3, 'COMMA')}원|">
            결제예정금액: 0원
          </p>
          <button class="order-btn" type="submit">결제 하기</button>
        </div>
      </div>
    </section>
  </div>
</body>

</html>